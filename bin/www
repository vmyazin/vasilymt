#!/usr/bin/env node

const app = require('../app');
const debug = require('debug')('simple-express-site:server');

/**
 * Initialize server based on environment
 */

if (typeof(PhusionPassenger) !== 'undefined') {
  app.listen('passenger');
} else {
  const http = require('http');
  const port = normalizePort(process.env.PORT || '3502');
  app.set('port', port);
  
  const server = http.createServer(app);
  server.listen(port);
  server.on('error', onError);
  server.on('listening', () => {
    console.log('Listening on port', port);
    debug('Listening on port ' + port);
  });
}

function normalizePort(val) {
  const port = parseInt(val, 10);
  if (isNaN(port)) return val;
  if (port >= 0) return port;
  return false;
}

function onError(error) {
  if (error.syscall !== 'listen') throw error;
  process.exit(1);
}